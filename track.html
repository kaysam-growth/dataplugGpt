<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>Track Order ‚Äî SwiftData GH</title>
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet"/>
<style>
:root{--blue:#0051ff;--offwht:#f4f7ff;--muted:#6b7a99;--card:#fff;--red:#ef4444;--yellow:#f59e0b;--green:#22c55e;}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0;}
body{font-family:'Plus Jakarta Sans',sans-serif;background:var(--offwht);color:#0a0f1e;min-height:100vh;display:flex;flex-direction:column;}
nav{height:60px;display:flex;align-items:center;background:#fff;border-bottom:1.5px solid rgba(0,81,255,.1);padding:0 2rem;}
.logo{font-weight:800;font-size:1.1rem;}.logo span{color:var(--blue);}
.nav-right{margin-left:auto;}
main{flex:1;padding:3rem 2rem;display:flex;align-items:center;justify-content:center;}
.track-card{background:var(--card);border-radius:28px;padding:2.75rem;max-width:520px;width:100%;box-shadow:0 20px 60px rgba(0,81,255,.08);border:1.5px solid rgba(0,81,255,.07);}
.card-icon{width:72px;height:72px;background:rgba(0,81,255,.08);border-radius:20px;display:flex;align-items:center;justify-content:center;font-size:2rem;margin:0 auto 1.5rem;}
.track-card h2{font-weight:800;font-size:1.6rem;text-align:center;margin-bottom:.4rem;}
.track-card .sub{font-size:.88rem;color:var(--muted);text-align:center;margin-bottom:2rem;line-height:1.6;}
.t-input{width:100%;padding:1rem 1.25rem;border:2px solid rgba(0,0,0,.08);border-radius:14px;font-family:inherit;font-size:1rem;font-weight:600;background:var(--offwht);color:#0a0f1e;outline:none;transition:border-color .2s;margin-bottom:.9rem;}
.t-input:focus{border-color:var(--blue);}
.t-btn{width:100%;padding:.9rem;background:var(--blue);color:#fff;border:none;border-radius:14px;font-family:inherit;font-weight:800;font-size:1rem;cursor:pointer;transition:all .2s;}
.t-btn:hover{transform:translateY(-2px);box-shadow:0 10px 28px rgba(0,81,255,.35);}
.results{margin-top:1.75rem;}
.result-card{background:var(--offwht);border-radius:14px;padding:1.1rem 1.25rem;border:1.5px solid rgba(0,0,0,.06);margin-bottom:.7rem;}
.r-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:.45rem;}
.r-bundle{font-weight:800;font-size:.95rem;}
.r-status{font-size:.7rem;font-weight:800;padding:.22rem .7rem;border-radius:50px;color:#fff;}
.rs-Pending{background:var(--yellow);}.rs-Processing{background:var(--blue);}.rs-Delivered{background:var(--green);}.rs-Failed{background:var(--red);}
.r-ref{font-size:.75rem;font-weight:700;color:var(--blue);font-family:monospace;letter-spacing:1px;margin-bottom:.25rem;}
.r-time{font-size:.75rem;color:var(--muted);}
.no-results{text-align:center;color:var(--red);font-weight:700;padding:1.5rem;font-size:.9rem;}
.back-link{display:block;text-align:center;margin-top:2rem;font-size:.8rem;font-weight:700;color:var(--muted);text-decoration:none;text-transform:uppercase;letter-spacing:1.5px;transition:color .2s;}
.back-link:hover{color:var(--blue);}
</style>
</head>
<body>
<nav>
  <div class="logo">SwiftData<span>GH</span></div>
  <div class="nav-right">
    <a href="/" class="back-link">‚Üê Home</a>
  </div>
</nav>
<main>
  <div class="track-card">
    <div class="card-icon">üì¶</div>
    <h2>Track Your Order</h2>
    <p class="sub">Enter phone number or order reference (e.g. <strong>SdG-001</strong>)</p>
    <input class="t-input" type="text" id="t-input" placeholder="05XXXXXXXX or SdG-001"/>
    <button class="t-btn" onclick="checkStatus()">Check Status</button>
    <div class="results" id="results"></div>
    <a class="back-link" href="/">‚Üê Return to Store</a>
  </div>
</main>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-auth.js";
import { getFirestore, collection, onSnapshot } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCs7lN4itvWZPichtFLdEE4swNQHSX_j1M",
  authDomain: "dataplus-a93c7.firebaseapp.com",
  projectId: "dataplus-a93c7",
  storageBucket: "dataplus-a93c7.firebasestorage.app",
  messagingSenderId: "1040979049946",
  appId: "1:1040979049946:web:d5d7957a6c209f56dd94e3"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let allOrders = [];

window.checkStatus = () => {
  const raw = document.getElementById('t-input').value.trim();
  const res = document.getElementById('results');
  
  if (!raw) {
    res.innerHTML = '<div class="no-results">Please enter phone or reference.</div>';
    return;
  }

  let found = [];
  if (/^sdg-/i.test(raw)) {
    found = allOrders.filter(o => o.orderRef && o.orderRef.toLowerCase() === raw.toLowerCase());
  } else {
    const phone = raw.replace(/\D/g, '');
    if (phone.length !== 10) {
      res.innerHTML = '<div class="no-results">Enter 10-digit phone or SdG-001</div>';
      return;
    }
    found = allOrders.filter(o => o.recipient === phone);
  }

  if (!found.length) {
    res.innerHTML = '<div class="no-results">‚ùå No orders found.</div>';
    return;
  }

  res.innerHTML = found.slice(0, 5).map(o => `<div class="result-card">
    <div class="r-top">
      <span class="r-bundle">${o.size} (${o.network})</span>
      <span class="r-status rs-${o.status}">${o.status}</span>
    </div>
    ${o.orderRef ? `<div class="r-ref">${o.orderRef}</div>` : ''}
    <div class="r-time">${o.createdAt ? new Date(o.createdAt.seconds * 1000).toLocaleString() : 'Just now'}</div>
  </div>`).join('');
};

document.getElementById('t-input').addEventListener('keydown', (e) => {
  if (e.key === 'Enter') window.checkStatus();
});

signInAnonymously(auth).catch(e => console.error('Auth error:', e));

onSnapshot(collection(db, 'orders'), (snap) => {
  allOrders = snap.docs.map(d => ({id: d.id, ...d.data()})).sort((a, b) => (b.createdAt?.seconds || 0) - (a.createdAt?.seconds || 0));
}, (err) => console.error('Orders error:', err));
</script>
</body>
</html>
