<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>DATAPLUS GH</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600;700&display=swap" rel="stylesheet">

<script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore-compat.js"></script>

<style>
:root {
  --bg:#020617; --card:rgba(15,23,42,.85); --border:rgba(255,255,255,.08);
  --text:#f8fafc; --accent:#38bdf8;
}
.light {
  --bg:#f8fafc; --card:#fff; --border:rgba(0,0,0,.1);
  --text:#020617; --accent:#2563eb;
}
body{
  margin:0;font-family:'Space Grotesk',sans-serif;
  background:radial-gradient(circle at top,#0f172a,var(--bg));
  color:var(--text);
}
header{
  padding:20px;display:flex;justify-content:space-between;align-items:center;
}
button{
  background:linear-gradient(135deg,var(--accent),#6366f1);
  border:none;padding:10px 16px;border-radius:14px;font-weight:700;cursor:pointer;
}
.container{max-width:1000px;margin:auto;padding:20px;}
.card{
  background:var(--card);border:1px solid var(--border);
  border-radius:20px;padding:22px;margin-bottom:16px;
}
.price{color:var(--accent);font-size:20px;font-weight:700;}
input,select{
  width:100%;padding:12px;border-radius:12px;border:1px solid var(--border);
  background:transparent;color:var(--text);margin-bottom:10px;
}
#announcement{
  display:none;padding:12px;text-align:center;
  background:linear-gradient(90deg,#38bdf8,#6366f1);color:#020617;font-weight:700;
}
.whatsapp{
  position:fixed;right:20px;bottom:20px;background:#25d366;color:#fff;
  padding:14px 20px;border-radius:999px;font-weight:800;text-decoration:none;
}
</style>
</head>

<body>

<div id="announcement"></div>

<header>
  <strong>DATAPLUS GH</strong>
  <div>
    <button onclick="toggleTheme()">ðŸŒ“</button>
    <button onclick="adminLogin()">Admin Login</button>
  </div>
</header>

<div class="container" id="app">Loadingâ€¦</div>

<a class="whatsapp" href="https://whatsapp.com/channel/0029VbBxGK6KrWR2RGMUlm1Z" target="_blank">
Join WhatsApp
</a>

<script>
/* FIREBASE */
firebase.initializeApp({
  apiKey: "AIzaSyCs7lN4itvWZPichtFLdEE4swNQHSX_j1M",
  authDomain: "dataplus-a93c7.firebaseapp.com",
  projectId: "dataplus-a93c7",
  storageBucket: "dataplus-a93c7.appspot.com",
  messagingSenderId: "1040979049946",
  appId: "1:1040979049946:web:d5d7957a6c209f56dd94e3"
});

const auth = firebase.auth();
const db = firebase.firestore();

/* ðŸ” ADMIN CONFIG */
const ADMIN_EMAIL = "kaysamgrowth@gmail.com";
const ADMIN_UID   = "ANwgaBBGe2fLyom7yzujdzQAY1k1";
let isAdmin = false;

/* THEME */
if(localStorage.theme==="light")document.body.classList.add("light");
function toggleTheme(){
  document.body.classList.toggle("light");
  localStorage.theme=document.body.classList.contains("light")?"light":"dark";
}

/* AUTH FLOW */
auth.onAuthStateChanged(async user=>{
  if(user){
    isAdmin = user.uid === ADMIN_UID;
    loadProducts();
  } else {
    await auth.signInAnonymously();
  }
});

/* ADMIN LOGIN */
function adminLogin(){
  const email=prompt("Admin email:");
  const pass=prompt("Admin password:");
  if(!email||!pass)return;
  auth.signInWithEmailAndPassword(email,pass)
    .then(()=>alert("Admin logged in"))
    .catch(e=>alert(e.message));
}

/* ANNOUNCEMENTS */
db.collection("config").doc("app").onSnapshot(d=>{
  if(!d.exists)return;
  announcement.style.display=d.data().announcementActive?"block":"none";
  announcement.textContent=d.data().announcementText||"";
});

/* PRODUCTS */
async function loadProducts(){
  const snap=await db.collection("products").where("active","==",true).get();
  let html="";
  snap.forEach(doc=>{
    const p=doc.data();
    html+=`
    <div class="card">
      <h3>${p.name}</h3>
      <div class="price">GHS ${p.price}</div>
      ${
        p.category==="physical"
        ? `<a href="${p.buyLink}" target="_blank"><button>Buy Item</button></a>`
        : `<button onclick="order('${doc.id}','${p.name}',${p.price})">Buy Data</button>`
      }
    </div>`;
  });
  if(isAdmin)html+=adminPanel();
  app.innerHTML=html;
}

/* ORDER */
function order(id,name,price){
  const phone=prompt("Phone number");
  const ref=prompt("MoMo reference");
  if(!phone||!ref)return;
  db.collection("orders").add({
    productId:id,productName:name,price,phone,momoRef:ref,
    status:"Pending Approval",
    createdAt:firebase.firestore.FieldValue.serverTimestamp()
  });
  alert("Order submitted");
}

/* ADMIN PANEL */
function adminPanel(){
  return `
  <div class="card">
    <h3>ðŸ›  Admin Panel</h3>
    <p style="color:lime;">Admin active</p>

    <input id="pname" placeholder="Product name">
    <input id="pprice" type="number" placeholder="Price">
    <select id="pcat">
      <option value="data">Data</option>
      <option value="physical">Physical</option>
    </select>
    <input id="plink" placeholder="Buy link (physical)">
    <button onclick="addProduct()">Add Product</button>

    <hr>
    <button onclick="loadOrders()">View Orders</button>
    <button onclick="auth.signOut()">Logout Admin</button>
    <div id="orders"></div>
  </div>`;
}

function addProduct(){
  db.collection("products").add({
    name:pname.value,
    price:Number(pprice.value),
    category:pcat.value,
    buyLink:plink.value||"",
    active:true,
    createdAt:firebase.firestore.FieldValue.serverTimestamp()
  });
  loadProducts();
}

async function loadOrders(){
  const snap=await db.collection("orders").orderBy("createdAt","desc").get();
  orders.innerHTML=snap.docs.map(d=>{
    const o=d.data();
    return`
    <div class="card">
      <b>${o.productName}</b>
      <p>${o.phone}</p>
      <p>${o.status}</p>
      ${
        o.status!=="Approved"
        ? `<button onclick="approve('${d.id}')">Approve</button>`
        : `<span style="color:lime;">Approved</span>`
      }
    </div>`;
  }).join("");
}

function approve(id){
  db.collection("orders").doc(id).update({status:"Approved"});
  loadOrders();
}
</script>
</body>
  </html>
